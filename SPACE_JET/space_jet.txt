
; You may customize this and other start-up templates; 
; The location of this template is c:\emu8086\inc\0_com_template.txt

org 100h          
                               
                                 MOV Ax,0B800H
                          MOV ES,AX
                          MOV AH,00H
                          MOV AL,03H
                          INT 10H
                                        
                                         
                                         
                           MOV AX,0548H          
                                      
                                      
                         
                                      mov cx,40d
                                      mov di,00h  
                                      call P
                                      mov cx,40d
                                      mov di,0f00h
                                      call p 
                                      
                                       
                                      
                        
                          SUB DI,0A0H
                          MOV CX,24D     
                          
                          BORDER:  SUB DI,0A0H 
                                   MOV ES:[DI],AX
                                   MOV ES:[DI+013cH],AX
                                   LOOP BORDER
                          MOV AX,0C57H
                          MOV CX,38D
                          MOV DI,00A4H
                          CALL P  
                            MOV CX,38D
                          ADD DI,08H
                          CALL P            
                                           
                          MOV DI,0E0CH  
                          MOV AX,0B2AH            
                          MOV ES:[DI],AX 
                          
                          MOV BX,ES:[DI]
                          MOV [2000H],BX   
                          MOV [2002H],025EH    
                          
                          
                          MAIN:
                                  MOV AH,01H
                                  INT 16H
                                  JZ  UPDATE
                                  MOV AH,00H
                                  INT 16H
                                  CALL NEXT
                                         JMP MAIN
                                         
                                                  
                                                    
NEXT:   

CMP AL,'W'
JNE DWN     
CALL UP
RET   

DWN:    
CMP AL,'S'
JNE LFT
CALL DOWN
RET    

LFT:    
CMP AL,'A'
JNE RHT
CALL LEFT
RET    

RHT:    
CMP AL,'D'
JNE FR
CALL RIGHT
RET

FR:
CMP AL,'F'
JNE NEXT
OR FLAG,10000000B
CALL FIRE
RET

                                   
                          RET                           
                             
                          RIGHT:
                          MOV AX,[2000H]
                          XCHG AX,ES:[DI+04H]
                          MOV ES:[DI],AX
                          ADD DI,04H
                          MOV AX,ES:[DI]
                          MOV [2000H],AX
                          ret
                          
                          LEFT:
                          MOV AX,[2000H]
                          XCHG AX,ES:[DI-04H]
                          MOV ES:[DI],AX
                          SUB DI,04H
                          MOV AX,ES:[DI]
                          MOV [2000H],AX
                          ret   
                             
                             
                          DOWN:   
                          MOV AX,[2000H]
                          XCHG AX,ES:[DI+0A0H]
                          MOV ES:[DI],AX
                          ADD DI,0A0H
                          MOV AX,ES:[DI]
                          MOV [2000H],AX
                          ret
                             

                             
                          UP:
                          MOV AX,[2000H]
                          XCHG AX,ES:[DI-0A0H]
                          MOV ES:[DI],AX
                          SUB DI,0A0H
                          MOV AX,ES:[DI]
                          MOV [2000H],AX
                          ret

                          FIRE:
                          MOV BX,DI  
                          SUB DI,0A0H
                          MOV ES:[DI],0A5EH 
                          MOV SI,PTR 
                          MOV [SI],DI
                          ADD SI,02H
                          CMP SI,2068H
                          JB NOPE
                          MOV SI,2040H
                          NOPE:
                          MOV PTR,SI
                          MOV DI,BX
                          RET
                              
                       UPDATE:
        
        MOV AX,DI          
        MOV SI,2040H
        MOV CX,20D         
LK:
        MOV BX,[SI]        
        CMP BX,0
        JE SKIP            
        MOV DI,BX
        MOV ES:[DI],0700H  
        SUB BX,00A0H
        MOV DI,BX
        CMP ES:[DI],0700H
        JNE ERASE
        MOV [SI],BX
        MOV ES:[DI],0A5EH
        JMP SKIP
        ERASE:
        CMP ES:[DI],0548H
        JE ER
        MOV ES:[DI],0700H
        ER:MOV [SI],00H
        MOV [SI+1H],00H
      
          

SKIP:
        ADD SI,2
        LOOP LK 
        MOV DI,AX
        JMP MAIN

                              
                              
                           P:  
                                
                                  MOV ES:[DI],AX
                                  add DI,04H
                                  LOOP P      
                                 
                                          ret 
                                     
                       PTR DW 2040H
                           
                                     
                                          
                         FLAG DB 00000000B